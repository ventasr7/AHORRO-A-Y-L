<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Ahorros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-md mx-auto">
        <h1 class="text-3xl font-bold text-center mb-2 text-blue-600 dark:text-blue-400">Control de Ahorros</h1>
        <p class="text-center text-gray-500 dark:text-gray-400 mb-6">Registra tus movimientos y alcanza tu meta.</p>

        <!-- Resumen de Ahorros -->
        <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 class="text-sm text-gray-500 dark:text-gray-400">Balance Actual</h2>
                    <p id="balance" class="text-4xl font-bold text-gray-900 dark:text-white">$0.00</p>
                </div>
                <div class="text-right">
                    <h2 class="text-sm text-gray-500 dark:text-gray-400">Meta</h2>
                    <p id="goal" class="text-2xl font-semibold text-blue-600 dark:text-blue-400">$1,000.00</p>
                </div>
            </div>

            <!-- Barra de Progreso -->
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4">
                <div id="progress-bar" class="bg-blue-600 h-4 rounded-full progress-bar-fill" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                <span id="progress-text">0% alcanzado</span>
                <button id="edit-goal-btn" class="hover:text-blue-500 focus:outline-none">Editar Meta</button>
            </div>
        </section>

        <!-- A침adir Transacci칩n -->
        <section class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-4">A침adir Nueva Transacci칩n</h2>
            <form id="form">
                <div class="mb-4">
                    <label for="text" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Descripci칩n</label>
                    <input type="text" id="text" placeholder="Ej: Salario, Compra online..." class="w-full p-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-4">
                    <label for="amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Monto</label>
                    <input type="number" id="amount" placeholder="0.00" step="0.01" class="w-full p-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                 <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Transacci칩n</label>
                    <div class="flex gap-4">
                        <label class="flex-1">
                            <input type="radio" name="transaction-type" value="deposit" class="sr-only peer" checked>
                            <div class="w-full p-3 text-center text-green-600 bg-green-100 dark:bg-green-900/50 rounded-lg cursor-pointer border border-green-200 dark:border-green-800 peer-checked:ring-2 peer-checked:ring-green-500 peer-checked:font-bold">
                                Dep칩sito
                            </div>
                        </label>
                        <label class="flex-1">
                            <input type="radio" name="transaction-type" value="withdrawal" class="sr-only peer">
                            <div class="w-full p-3 text-center text-red-600 bg-red-100 dark:bg-red-900/50 rounded-lg cursor-pointer border border-red-200 dark:border-red-800 peer-checked:ring-2 peer-checked:ring-red-500 peer-checked:font-bold">
                                Retiro
                            </div>
                        </label>
                    </div>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-colors">
                    A침adir Transacci칩n
                </button>
            </form>
        </section>

        <!-- Historial de Transacciones -->
        <section>
            <h2 class="text-xl font-semibold mb-4 text-center">Historial</h2>
            <ul id="list" class="space-y-3">
                <!-- Las transacciones se a침adir치n aqu칤 din치micamente -->
            </ul>
        </section>

    </main>

    <script>
        const balance = document.getElementById('balance');
        const goal = document.getElementById('goal');
        const list = document.getElementById('list');
        const form = document.getElementById('form');
        const textInput = document.getElementById('text');
        const amountInput = document.getElementById('amount');
        const editGoalBtn = document.getElementById('edit-goal-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');

        // Obtener transacciones y meta del almacenamiento local
        const localStorageTransactions = JSON.parse(localStorage.getItem('transactions'));
        let transactions = localStorage.getItem('transactions') !== null ? localStorageTransactions : [];
        let savingsGoal = localStorage.getItem('savingsGoal') !== null ? parseFloat(localStorage.getItem('savingsGoal')) : 1000;

        // Formatear n칰mero como moneda
        function formatCurrency(num) {
            return '$' + num.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }

        // A침adir transacci칩n
        function addTransaction(e) {
            e.preventDefault();

            if (textInput.value.trim() === '' || amountInput.value.trim() === '') {
                alert('Por favor, a침ade una descripci칩n y un monto');
            } else {
                const transactionType = document.querySelector('input[name="transaction-type"]:checked').value;
                const amount = transactionType === 'withdrawal' ? -Math.abs(amountInput.value) : +Math.abs(amountInput.value);

                const transaction = {
                    id: generateID(),
                    text: textInput.value,
                    amount: amount
                };

                transactions.push(transaction);
                addTransactionDOM(transaction);
                updateValues();
                updateLocalStorage();

                textInput.value = '';
                amountInput.value = '';
            }
        }

        // Generar ID 칰nico
        function generateID() {
            return Math.floor(Math.random() * 100000000);
        }
        
        // A침adir transacciones al DOM
        function addTransactionDOM(transaction) {
            const sign = transaction.amount < 0 ? '-' : '+';
            const item = document.createElement('li');
            
            const itemClass = transaction.amount < 0 ? 'border-red-500' : 'border-green-500';

            item.classList.add('bg-white', 'dark:bg-gray-800', 'p-4', 'rounded-xl', 'shadow-lg', 'flex', 'justify-between', 'items-center', 'border-l-4', itemClass);
            item.innerHTML = `
                <div class="flex items-center">
                    <button onclick="removeTransaction(${transaction.id})" class="text-gray-400 hover:text-red-500 mr-4 focus:outline-none">&times;</button>
                    <span class="font-medium">${transaction.text}</span>
                </div>
                <span class="font-bold ${transaction.amount < 0 ? 'text-red-500' : 'text-green-500'}">
                    ${sign}${formatCurrency(Math.abs(transaction.amount))}
                </span>
            `;
            list.appendChild(item);
        }

        // Actualizar el balance y la meta
        function updateValues() {
            const amounts = transactions.map(transaction => transaction.amount);
            const total = amounts.reduce((acc, item) => (acc += item), 0);
            
            balance.innerText = formatCurrency(total);
            goal.innerText = formatCurrency(savingsGoal);

            // Actualizar barra de progreso
            const progress = (total / savingsGoal) * 100;
            const progressClamped = Math.max(0, Math.min(progress, 100)); // Asegura que el progreso est칠 entre 0 y 100
            
            progressBar.style.width = `${progressClamped}%`;
            progressText.innerText = `${Math.round(progressClamped)}% alcanzado`;

            if (total >= savingsGoal) {
                progressBar.classList.remove('bg-blue-600');
                progressBar.classList.add('bg-yellow-400');
                progressText.innerText = `춰Meta alcanzada! 游꿀 (${Math.round(progress)}%)`;
            } else {
                progressBar.classList.remove('bg-yellow-400');
                progressBar.classList.add('bg-blue-600');
            }
        }

        // Eliminar transacci칩n
        function removeTransaction(id) {
            transactions = transactions.filter(transaction => transaction.id !== id);
            updateLocalStorage();
            init();
        }

        // Actualizar almacenamiento local
        function updateLocalStorage() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            localStorage.setItem('savingsGoal', savingsGoal);
        }

        // Editar la meta
        function editGoal() {
            const newGoal = prompt('Establece tu nueva meta de ahorro:', savingsGoal);
            if (newGoal !== null && !isNaN(newGoal) && newGoal > 0) {
                savingsGoal = parseFloat(newGoal);
                updateValues();
                updateLocalStorage();
            }
        }
        
        // Inicializar la aplicaci칩n
        function init() {
            list.innerHTML = '';
            transactions.forEach(addTransactionDOM);
            updateValues();
        }

        init();

        // Event Listeners
        form.addEventListener('submit', addTransaction);
        editGoalBtn.addEventListener('click', editGoal);

    </script>
</body>
</html>
